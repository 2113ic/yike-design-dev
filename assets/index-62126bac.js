import{d as P,dD as Y,e7 as O,o as f,b as _,f as I,dr as Q,dq as y,n as E,c as w,eh as $,ep as ne,eq as ae,er as se,e as F,dH as le,g as R,j as X,t as oe,w as G,dZ as de,es as x,et as re,dX as ce,q as ee,a as ie,F as j,i as z,eu as Z,dE as ue,ef as pe,dF as H,ev as D,dG as A,r as fe,dT as ye,ew as he,d_ as ve,ex as ke,dU as me}from"./index-79e930ed.js";import{Y as ge}from"./index-7dac4f4d.js";const q=Symbol("TreeInjectionKey"),U=Symbol("TreeNodeInjectionKey"),Ke=P({__name:"node-switcher",setup(p){const n=Y("tree-node-switcher"),t=O(U),d=O(q);return(e,r)=>{var v,B,m,b;return f(),_("span",{class:E(y(n)([(v=y(t))!=null&&v.expanded.value?"rotate":"",(B=y(t))!=null&&B.isLeaf?"leaf":""])),onClick:r[0]||(r[0]=N=>{var K,k,i,c;return(c=(K=y(d))==null?void 0:K.onExpand)==null?void 0:c.call(K,(k=y(t))==null?void 0:k.option.key,(i=y(t))==null?void 0:i.expanded.value)})},[(f(),I(Q((b=(m=y(d))==null?void 0:m.expandIcon)==null?void 0:b.call(m))))],2)}}});function L(p){var t;let n=[];return(t=p.children)==null||t.forEach(d=>{n.push(d.key),d.children&&d.children.length>0&&(n=n.concat(L(d)))}),n}const _e=P({__name:"tree-node",props:{label:{},node:{}},setup(p){const n=p,t=Y("tree-node"),d=w(()=>t()),e=O(q),r=O(U),v=w(()=>{var i;return!!((i=e==null?void 0:e.selectedKeys)!=null&&i.includes(n.node.key))}),B=w(()=>t("content",[e!=null&&e.blockNode?"block":void 0,v.value?"active":void 0])),m=Object.assign({fold:()=>$(ne),unfold:()=>$(ae),file:()=>$(se)},e==null?void 0:e.fileIcons,n.node.icons),b=w(()=>e!=null&&e.fileTree?r!=null&&r.isLeaf?m.file:r!=null&&r.expanded.value?m.unfold:m.fold:null),N=i=>{var h,o,S,g;let c=[n.node.key];if(!(e!=null&&e.checkStrictly)){const u=(h=e==null?void 0:e.nodeMaps)==null?void 0:h.get(n.node.key);if(u&&u.pKey){const C=(o=e==null?void 0:e.nodeMaps)==null?void 0:o.get(u.pKey);C&&((S=C.children)!=null&&S.every(M=>{var a,s;return(s=(a=e==null?void 0:e.checkedKeys)==null?void 0:a.concat([n.node.key]))==null?void 0:s.includes(M.key)}))&&c.push(C.key)}c.push(...L(n.node))}(g=e==null?void 0:e.onChecked)==null||g.call(e,c,i)},K=w(()=>{var i,c;return e!=null&&e.checkStrictly?!1:((i=n.node.children)==null?void 0:i.some(h=>{var o;return(o=e==null?void 0:e.checkedKeys)==null?void 0:o.includes(h.key)}))&&!((c=n.node.children)!=null&&c.every(h=>{var o;return(o=e==null?void 0:e.checkedKeys)==null?void 0:o.includes(h.key)}))}),k=w(()=>{var i,c,h;return e!=null&&e.checkStrictly?(i=e==null?void 0:e.checkedKeys)==null?void 0:i.includes(n.node.key):((c=e==null?void 0:e.checkedKeys)==null?void 0:c.includes(n.node.key))||((h=n.node.children)==null?void 0:h.every(o=>{var S;return(S=e==null?void 0:e.checkedKeys)==null?void 0:S.includes(o.key)}))});return(i,c)=>{var h,o;return f(),_("div",{class:E(d.value)},[F(Ke),(h=y(e))!=null&&h.checkable?(f(),_("span",{key:0,class:E(y(t)("checkbox")),onClick:c[0]||(c[0]=le(()=>{},["stop"]))},[F(y(ge),{checked:k.value,indeterminate:K.value,onChange:N},null,8,["checked","indeterminate"])],2)):R("",!0),X("div",{class:E(B.value),onClick:c[1]||(c[1]=S=>{var g,u;return(u=(g=y(e))==null?void 0:g.onSelect)==null?void 0:u.call(g,n.node.key)})},[(o=y(e))!=null&&o.fileTree?(f(),_("span",{key:0,class:E(y(t)("file"))},[(f(),I(Q(b.value)))],2)):R("",!0),X("span",null,oe(i.label),1)],2)],2)}}}),be=P({__name:"expand-transition",setup(p){const n=Y("collapse"),t=e=>{e.style.maxHeight="",e.style.overflow=e.dataset.oldOverflow,e.style.paddingTop=e.dataset.oldPaddingTop,e.style.paddingBottom=e.dataset.oldPaddingBottom},d={beforeEnter(e){e.dataset||(e.dataset={}),e.dataset.oldPaddingTop=e.style.paddingTop,e.dataset.oldPaddingBottom=e.style.paddingBottom,e.style.maxHeight=0,e.style.paddingTop=0,e.style.paddingBottom=0},enter(e){e.dataset.oldOverflow=e.style.overflow,e.scrollHeight!==0?e.style.maxHeight=`${e.scrollHeight}px`:e.style.maxHeight=0,e.style.paddingTop=e.dataset.oldPaddingTop,e.style.paddingBottom=e.dataset.oldPaddingBottom,e.style.overflow="hidden"},afterEnter(e){e.style.maxHeight="",e.style.overflow=e.dataset.oldOverflow},enterCancelled(e){t(e)},beforeLeave(e){e.dataset||(e.dataset={}),e.dataset.oldPaddingTop=e.style.paddingTop,e.dataset.oldPaddingBottom=e.style.paddingBottom,e.dataset.oldOverflow=e.style.overflow,e.style.maxHeight=`${e.scrollHeight}px`,e.style.overflow="hidden"},leave(e){e.scrollHeight!==0&&(e.style.maxHeight=0,e.style.paddingTop=0,e.style.paddingBottom=0)},afterLeave(e){t(e)},leaveCancelled(e){t(e)}};return(e,r)=>(f(),I(ce,x({name:y(n)()},re(d)),{default:G(()=>[de(e.$slots,"default")]),_:3},16,["name"]))}}),we={key:0,class:"yk-tree__list"},J=P({__name:"node",props:{option:{}},setup(p){const n=p,t=O(q),d=w(()=>{var v;return!!((v=t==null?void 0:t.expandedKeys)!=null&&v.includes(n.option.key))}),e=w(()=>d.value&&!r.value),r=w(()=>!n.option.children||!n.option.children.length);return ee(U,{option:n.option,isLeaf:r.value,expanded:d}),(v,B)=>{const m=ie("node",!0);return f(),_(j,null,[F(_e,{label:v.option.label,node:v.option},null,8,["label","node"]),F(be,null,{default:G(()=>[e.value?(f(),_("div",we,[(f(!0),_(j,null,z(v.option.children,b=>(f(),I(m,{key:b.key,option:b},null,8,["option"]))),128))])):R("",!0)]),_:1})],64)}}}),V=(p,n)=>{const t=new Map;return p&&p.length===0||p==null||p.forEach(d=>{t.set(d.key,{...d,pKey:n});for(const[e,r]of V(d.children,d.key))t.set(e,r)}),t},Se=P({name:"YkTree",__name:"tree",props:Z({options:{},blockNode:{type:Boolean,default:!1},defaultExpandedKeys:{default(){return[]}},expandedKeys:{},selectedKeys:{},defaultSelectedKeys:{default(){return[]}},multiple:{type:Boolean,default:!1},expandIcon:{type:Function,default(){return $(ke)}},fileTree:{type:Boolean,default:!1},fileIcons:{},checkable:{type:Boolean,default:!1},checkedKeys:{},checkStrategy:{default:"all"},checkStrictly:{type:Boolean,default:!1},scrollbar:{default:!1},unSelectKey:{}},{expandedKeys:{local:!0,default:[]},selectedKeys:{local:!0,default:[]},checkedKeys:{default:[],local:!0}}),emits:Z(["expand","select","check"],["update:expandedKeys","update:selectedKeys","update:checkedKeys"]),setup(p,{emit:n}){const t=p,d=Y("tree"),{checkStrictly:e,checkStrategy:r,checkable:v,fileIcons:B,fileTree:m,blockNode:b,expandIcon:N,unSelectKey:K}=ue(t),k=pe(V(t.options));H(()=>t.options,()=>{k.value=V(t.options)});const i=D(p,"expandedKeys",{local:!0}),c=a=>{var l;h(a,!1,!0);const s=(l=k.value.get(a))==null?void 0:l.pKey;s&&c(s)};A(()=>{if(t.defaultExpandedKeys.length!==0)for(const a of t.defaultExpandedKeys)c(a)});const h=(a,s=!1,l=!1)=>{const T=new Set([...i.value]);s?T.delete(a):T.add(a),i.value=[...T],!l&&n("expand",i.value)},o=D(p,"selectedKeys",{local:!0});A(()=>{var a;if(t.defaultSelectedKeys.length!==0){o.value=t.defaultSelectedKeys;for(const s of t.defaultSelectedKeys){const l=(a=k.value.get(s))==null?void 0:a.pKey;l&&c(l)}}});const S=a=>{t.multiple?o.value=[...new Set([...o.value,a])]:o.value=[a],n("select",o.value)};H(()=>K==null?void 0:K.value,a=>{o.value=o.value.filter(s=>s!=a),v.value&&M([a],!1)});const g=D(p,"checkedKeys",{local:!0}),u=fe([]);u.value=[...g.value],H(e,a=>{if(a)C();else{let s=[];u.value.forEach(l=>{const T=k.value.get(l);if(!T)return;const te=L(T);s.push(l),te.forEach(W=>{s.includes(W)||s.push(W)})}),u.value=[...new Set(s)]}},{immediate:!0});const C=()=>{if(r.value==="all"||e.value){g.value=[...u.value];return}const a=[];u.value.forEach(s=>{if(!k.value.has(s))return;const l=L(k.value.get(s));if(l&&l.length>0&&l.every(T=>u.value.includes(T))){a.push(s);return}}),r.value==="parent"&&(g.value=u.value.filter(s=>{const l=k.value.get(s);return!(l&&l.pKey&&a.includes(l.pKey))})),r.value==="child"&&(g.value=u.value.filter(s=>!a.includes(s)))};H(u,C,{deep:!0,immediate:!0}),H(r,C);const M=(a,s)=>{s?u.value.push(...a):u.value=u.value.filter(l=>!a.includes(l))};return ee(q,ye({blockNode:b,expandedKeys:i,selectedKeys:o,checkedKeys:u,fileTree:m,fileIcons:B,checkable:v,checkStrategy:r,checkStrictly:e,expandIcon:N,nodeMaps:k,onSelect:S,onExpand:h,onChecked:M})),(a,s)=>(f(),_("div",{class:E(y(d)())},[t.scrollbar?(f(),I(y(ve),he(x({key:0},t.scrollbar)),{default:G(()=>[(f(!0),_(j,null,z(a.options,l=>(f(),I(J,{key:l.key,option:l},null,8,["option"]))),128))]),_:1},16)):(f(!0),_(j,{key:1},z(a.options,l=>(f(),I(J,{key:l.key,option:l},null,8,["option"]))),128))],2))}}),Te=me(Se),Ie=Te;export{Te as Y,Ie as _};
